## title: 已銷單庫存-已銷出貨功能規格\
version: 1.0\
date_created: 2025-11-13\
last_updated: 2025-11-13\
owner: 倉儲資訊系統開發團隊\
tags: [process, design, app, 出貨, 庫存, ASP.NET MVC]

# Introduction

本規格文件定義「已銷單庫存-已銷出貨」功能於 WebStoreHouse 系統中的需求、流程、介面、驗收標準與相關規範，確保出貨作業正確、安全且可追溯。

## 1\. Purpose & Scope

- 目的：規範「已銷單庫存」出貨作業，包含前端表單、後端流程、資料異動與驗證。
- 適用範圍：WebStoreHouse 系統內，針對已銷單庫存的出貨管理。
- 目標讀者：開發人員、測試人員、維運人員。
- 假設：使用者已登入並具備操作權限。

## 2\. Definitions

- 已銷單庫存：指已完成銷售但尚未出貨的庫存。
- 出貨明細：指每次出貨所產生的記錄。
- eng_sr：機種名稱（英文縮寫）。
- position：庫位。
- ship_quantity：本次出貨數量。
- transportation：出貨方式。
- E_StoreHouseStock_BOS：已銷單庫存資料表。
- E_StoreHouseStock_SC：預計出貨明細資料表。

## 3\. Requirements, Constraints & Guidelines

- **REQ-001**：系統須提供「已銷單庫存」出貨表單，顯示機種、庫位、現有庫存等資訊。
- **REQ-002**：使用者可輸入出貨數量與出貨方式。
- **REQ-003**：送出表單時，系統須驗證數量、權限與資料正確性。
- **REQ-004**：系統須於資料庫交易中完成庫存扣減、出貨明細新增。
- **REQ-005**：所有異動須可追溯，失敗時需完整回復。
- **REQ-006**：出貨完成後自動導向庫存總覽頁。
- **SEC-001**：所有操作須通過登入驗證。
- **CON-001**：出貨數量不得大於現有庫存。
- **GUD-001**：表單欄位需有即時驗證與錯誤提示。

## 4\. Interfaces & Data Contracts

### 前端 View (BOS_toShip.cshtml)

- 顯示：機種名稱、庫位、現有庫存（唯讀）、出貨數量（輸入）、出貨方式（輸入）。
- 欄位驗證：數量僅允許正整數，且不得為零。
- 送出方式：POST 至 Controller。

### Controller Action

- GET: [BOS_toShip(string eng_sr, string position)](vscode-file://vscode-app/c:/Program%20Files/Microsoft%20VS%20Code%20Insiders/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - 取得指定機種與庫位的庫存資料，回傳 View。
- POST: [BOS_toShip(string eng_sr, int ship_quantity, string position, string transportation)](vscode-file://vscode-app/c:/Program%20Files/Microsoft%20VS%20Code%20Insiders/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - 權限驗證
    - 查詢並更新 E_StoreHouseStock_BOS [已銷單庫存]
    - 新增出貨明細至 E_StoreHouseStock_SC [預計出貨]
    - 交易提交或回復
    - 導向總覽頁或回原頁顯示錯誤

### 資料表

- E_StoreHouseStock_BOS：eng_sr, position, quantity, ship_quantity, ship_date, transportation
- E_StoreHouseStock_SC：exp_shipdate, eng_sr, exp_shipquantity, stock_quantity, position, transportation, IsApproved, sales_order, cust_wono, wono

## 5\. Acceptance Criteria

- **AC-001**：Given 使用者已登入，When 進入出貨頁，Then 顯示正確庫存資訊。
- **AC-002**：Given 欄位輸入錯誤，When 送出表單，Then 顯示即時錯誤訊息且不進行異動。
- **AC-003**：Given 出貨數量正確，When 送出表單，Then 正確扣減庫存並新增出貨明細。
- **AC-004**：Given 資料異常或交易失敗，When 送出表單，Then 不異動資料並顯示錯誤。
- **AC-005**：Given 出貨成功，When 完成作業，Then 自動導向庫存總覽頁。

## 6\. Test Automation Strategy

- **Test Levels**：單元測試、整合測試、UI自動化測試。
- **Frameworks**：MSTest、Selenium、FluentAssertions。
- **Test Data Management**：測試前建立測試資料，測試後自動清除。
- **CI/CD Integration**：於 GitHub Actions 執行自動化測試。
- **Coverage Requirements**：關鍵流程測試覆蓋率 90% 以上。
- **Performance Testing**：模擬高併發出貨操作。

## 7\. Rationale & Context

- 確保出貨流程資料正確、可追溯，並防止誤操作造成庫存異常。
- 交易機制避免部分異動導致資料不一致。
- 欄位驗證與權限控管提升系統安全性。

## 8\. Dependencies & External Integrations

### External Systems

- 無

### Third-Party Services

- 無

### Infrastructure Dependencies

- SQL Server 資料庫

### Data Dependencies

- 需有 E_StoreHouseStock_BOS、E_StoreHouseStock_SC 資料表

### Technology Platform Dependencies

- ASP.NET MVC 5
- Entity Framework 6

### Compliance Dependencies

- 無

## 9\. Examples & Edge Cases

## 10\. Validation Criteria

- 所有欄位驗證皆正確運作
- 權限驗證必須通過
- 出貨數量異常時不應異動資料
- 出貨明細正確寫入
- 交易失敗時資料自動回復
- 測試覆蓋率達標

